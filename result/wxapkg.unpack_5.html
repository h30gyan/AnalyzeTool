<link rel="stylesheet" href="../css/bootstrap.min.css">
<script src="../js/jquery.js"></script>
<script src="../js/vue.js"></script>
<style>
    .panel {
        word-wrap: break-word;

        word-break: keep-all;

        overflow: hidden;
    }

    th {
        text-align: center;
        font-weight: normal;
        font-size: 14px;

    }

    th:hover {
        background-color: #ccdde6;
    }

    td {
        text-align: center;
        font-weight: normal;
        font-size: 14px;

    }

    a.navbar-brand {
        color: white;
    }

    a.navbar-brand:hover {
        text-decoration: none
    }

    a:link {
        color: inherit;
        text-decoration: none
    }

    .filter-label {
        height: 10px;
        font-size: small;
        margin-top: 3px;
    }

    div .view-text {
        text-align: left;
        overflow-y: auto;
    }

    .view-btn {
        text-align: right;
        font-size: medium;
        color: #d9534f;
    }

    span.view-text {
        border: 1px solid #9d9d9d;
        border-radius: 4px;
    }

    .hidden {
        display: none;
    }

    .emphasize {
        color: #d9534f;
    }

    .line {
        color: #9d9d9d;
    }

    .name-label {
        font-weight: normal;
        margin-top: 5px;
    }

    .file-name {
        font-weight: bold;
    }

    .file-path {
        color: chocolate;
        text-align: left;
    }
</style>


<div id="app">
    <div class="navbar navbar-fixed-top"
         style="position: fixed; height:60px ;z-index: 10000; width: 100%; background: rgb(8, 103, 193) none repeat scroll 0% 0%;">
        <div class="navbar-header">
            <a class="navbar-brand" href="#" style="color:white; margin-top: 4px">File Analysis Result</a>
        </div>
    </div>


    <div class="container-fluid" style="width: 95%; margin-top: 50px">
        <div class="panel panel-default" style="margin-top: 50px">
            <div class="panel-heading" style="background-color: white; border-bottom: none">


                <!--过滤标签区域-->
                <div class="col-md-4">
                    <span style="font-size: larger; margin-right: 3px; margin-left: -10px">
                    过滤关键词</span>
                    <label class="label label-info filter-label"><a
                            href="javascript:void(0)"><span class="glyphicon glyphicon-record"></span>
                        {{major_key}}</a></label>
                    <template v-for="key in include_keys">
                        <label class="label label-success filter-label" @click="del_in_key(key)"><a
                                href="javascript:void(0)" style="margin-left: 3px">
                            <span class=" glyphicon glyphicon-triangle-top"></span> {{key}}
                            &times;</a></label>&nbsp;
                    </template>
                    <template v-for="key in exclude_keys">
                        <label class="label label-danger label-lg filter-label" @click="del_ex_key(key)"><a
                                href="javascript:void(0)" style="margin-right: 3px">
                            <span class="glyphicon glyphicon-triangle-bottom"></span> {{key}}
                            &times;</a></label>&nbsp;
                    </template>
                </div>

                <!--新增过滤区域-->
                <div class="pull-right col-md-8">
                    <div class="col-md-1">
                        <label class="name-label">文件名</label>
                        <!--                        <span class="glyphicon glyphicon-play-circle"></span>-->
                    </div>
                    <div class="col-md-3">
                        <input class="pull-right form-control" v-model="target_file" />
                    </div>

                    <div class="col-md-3">
                        <input class="pull-right form-control" v-model="include_key" @keyup.enter="add_in_key"/>
                    </div>
                    <div class="col-md-1">
                        <button class="btn btn-default text-primary" style="color: #337ab7" @click="add_in_key">
                            包含
                        </button>
                    </div>
                    <div class="col-md-3">
                        <input class="pull-right form-control" v-model="exclude_key" @keyup.enter="add_ex_key"/>
                    </div>
                    <div class="col-md-1">
                        <button class="btn btn-default" style="color: #d9534f" @click="add_ex_key">不含</button>
                    </div>
                </div>

            </div>
            <div class="panel-body"></div>
            <table class="table table-responsive">
                <tr class="alert-info" style="color: black">
                    <th class="col-md-1">序号</th>
                    <th class="col-md-2">文件名</th>
                    <th class="col-md-3">文件路径</th>
                    <th class="col-md-6">预览</th>
                </tr>
                <template v-for="(file, index) in search">
                    <tr @mouseover="mouseOver(file)" @mouseleave="mouseLeave(file)" @click="fix_file(file)">
                        <td>
                            <span class="col-md-1 col-md-pull-1">
                            <span class="glyphicon glyphicon-lock text-left" v-if="file.lock"
                                  style="color: #d9534f"></span>
                            </span>
                                <span class="col-md-8 col-md-pull-2">
                            {{index+1}}
                            </span>
                        </td>
                        <td class="file-name">{{ file.name }}</td>
                        <td class="file-path">{{file.path}}</td>
                        <td class="view-text">


                            <div class="view-btn col-md-1"><a style="color: inherit; display: block"
                                                              href="javascript:void(0)" class="extend-icon">
                                <span class="glyphicon glyphicon-expand" v-if="!file.view"></span>
                                <span class="glyphicon glyphicon-collapse-down" v-else></span>
                            </a></div>


                            <div class="view-text col-md-11">
                                <!--单行内容-->
                                <span class="preview-text" v-html="switch_key(file.pre_content)"
                                      v-if="!file.view"></span>
                                <!--预览内容-->
                                <span class="view-text" style="display: block; height: 160px;"
                                      v-html="switch_key(file.content)" v-if="file.view"></span>
                            </div>
                        </td>
                    </tr>
                </template>
            </table>

        </div>
    </div>
</div>
<script>
    Vue.prototype.switch_key = function (value) {
        while (value.includes("  ")) {
            value = value.replace("  ", "&nbsp;&nbsp;")
        }
        while (value.includes("\t")) {
            value = value.replace("\t", "&nbsp;&nbsp;&nbsp;&nbsp;")
        }
        // alert(root.major_key);
        var reg_key = new RegExp(root.major_key, 'ig')
        var key_list = value.match(reg_key)
        for (i in root.include_keys){
            reg_key = new RegExp(i, 'ig')
            key_list.concat(value.match(reg_key))
        }
        key_list = Array.from(new Set(key_list))
        for (i in key_list) {
            value = value.replaceAll(key_list[i], "<span class='emphasize'>" + key_list[i] + "</span>")
        }
        return value
    }
    var root = new Vue({
        el: '#app',
        data: {
            major_key: "$1",
            include_keys: [],
            exclude_keys: [],
            include_key: "",
            exclude_key: "",
            target_file: "",
            files: []
        },
        methods: {
            mouseOver: function (file) {
                file.view = true
            },
            mouseLeave: function (file) {
                if (!file.lock) {
                    file.view = false
                }
            },
            add_in_key: function () {
                if (!(this.include_keys.includes(this.include_key)) && this.include_key) {
                    this.include_keys.push(this.include_key);
                }
                this.include_key = ""
            },
            add_ex_key: function () {
                if (!(this.exclude_keys.includes(this.exclude_key)) && this.exclude_key) {
                    this.exclude_keys.push(this.exclude_key);
                }
                this.exclude_key = ""
            },
            del_in_key: function (key) {
                this.include_keys.pop(key);
            },
            del_ex_key: function (key) {
                this.exclude_keys.pop(key);
            },
            fix_file: function (file) {
                file.lock = !file.lock
            }
        },
        computed: {
            search: function () {
                var files = this.files.filter(ele => {
                    var filter = true;
                    if (this.include_keys) {
                        if (!ele.content.includes(this.include_key)) {
                            filter = false
                        }
                    }
                    if (this.exclude_key) {
                        if (ele.content.includes(this.exclude_key)) {
                            filter = false
                        }
                    }
                    if (this.target_file) {
                        if (!ele.name.includes(this.target_file)) {
                            filter = false
                        }
                    }
                    for (i in this.include_keys) {
                        if (!ele.content.includes(this.include_keys[i])) {
                            filter = false
                        }
                    }
                    for (i in this.exclude_keys) {
                        if (ele.content.includes(this.exclude_keys[i]) || ele.path.includes(this.exclude_keys[i])) {
                            filter = false
                        }
                    }
                    return filter
                })
                return files
            }
        },
    })


    root.files.push({"id": 1, "name": "0796f95dafdcc44f48293e3f1c4fad70.js", "path": "F:\\\u5b66\u4e60\u7b14\u8bb0\\\u5fae\u4fe1\u9006\u5411\u5b66\u4e60\\core\\wxapkg.unpack\\0796f95dafdcc44f48293e3f1c4fad70.js", "pre_content": "<span class='line'>454</span>    // default to $$ = $1<br><span class='line'></span>      ", "content": "<span class='line'>451</span>    <br><span class='line'>452</span>                // perform semantic action<br><span class='line'>453</span>                yyval.$ = vstack[vstack.length - len];<br><span class='line'>454</span>                // default to $$ = $1<br><span class='line'>455</span>                // default location, uses first token for firsts, last for lasts<br><span class='line'>456</span>                yyval._$ = {<br><span class='line'>457</span>                  first_line: lstack[lstack.length - (len || 1)].first_line,", "view": false, "lock": false},{"id": 2, "name": "4a9f41491a6ed36535fffac993f656b0.js", "path": "F:\\\u5b66\u4e60\u7b14\u8bb0\\\u5fae\u4fe1\u9006\u5411\u5b66\u4e60\\core\\wxapkg.unpack\\4a9f41491a6ed36535fffac993f656b0.js", "pre_content": "<span class='line'>1</span>      ... unction).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g,\"$1.*?\")+\"$\");e.exports=fu ...<br><span class='line'></span>      ", "content": "<span class='line'>1</span>      ing,p=l.hasOwnProperty,d=RegExp(\"^\"+c.call(p).repl<br><span class='line'>1</span>      ace(/[\\\\^$.*+?()[\\]{}|]/g,\"\\\\$&\").replace(/hasOwnP<br><span class='line'>1</span>      roperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g,\"<br><span class='line'>1</span>      $1.*?\")+\"$\");e.exports=function(e){return!(!s(e)||<br><span class='line'>1</span>      i(e))&&(n(e)?d:o).test(a(e))}},function(e,t,r){va", "view": false, "lock": false},{"id": 3, "name": "58d982b21c06dca117a08e6fec90ccdb.js", "path": "F:\\\u5b66\u4e60\u7b14\u8bb0\\\u5fae\u4fe1\u9006\u5411\u5b66\u4e60\\core\\wxapkg.unpack\\58d982b21c06dca117a08e6fec90ccdb.js", "pre_content": "<span class='line'>1</span>      ... \":typeof e})(e)}function _classCallCheck$1(e,t){if(!(e instanceof ...<br><span class='line'></span>      ", "content": "<span class='line'>1</span>      ypeof e}:function(e){return e&&\"function\"==typeof <br><span class='line'>1</span>      Symbol&&e.constructor===Symbol&&e!==Symbol.prototy<br><span class='line'>1</span>      pe?\"symbol\":typeof e})(e)}function _classCallCheck<br><span class='line'>1</span>      $1(e,t){if(!(e instanceof t))throw new TypeError(\"<br><span class='line'>1</span>      Cannot call a class as a function\")}function _defi", "view": false, "lock": false},{"id": 4, "name": "6f1051662bfa23cd52d9e9b9804c7c93.js", "path": "F:\\\u5b66\u4e60\u7b14\u8bb0\\\u5fae\u4fe1\u9006\u5411\u5b66\u4e60\\core\\wxapkg.unpack\\6f1051662bfa23cd52d9e9b9804c7c93.js", "pre_content": "<span class='line'>2</span>      ... rt\"===e.name){let s=e.params.replace(i,\"$1\");s=t.findAbsolutePath ...<br><span class='line'></span>      ", "content": "<span class='line'>2</span>      /g,c=r.plugin(\"postcss-add-dep\",e=&gt;function(n){con<br><span class='line'>2</span>      st{absDeps:r=[],wxssFilePath:o}=e;n.walkAtRules(e=<br><span class='line'>2</span>      &gt;{if(\"import\"===e.name){let s=e.params.replace(i,\"<br><span class='line'>2</span>      $1\");s=t.findAbsolutePath(o,s,\"wxss\");const n=r.in<br><span class='line'>2</span>      dexOf(s);-1!==n&&r.splice(n,1)}}),r.forEach(e=&gt;{co", "view": false, "lock": false},{"id": 5, "name": "78fd31ff2c3e8878eb2cbf15dacc59f3.js", "path": "F:\\\u5b66\u4e60\u7b14\u8bb0\\\u5fae\u4fe1\u9006\u5411\u5b66\u4e60\\core\\wxapkg.unpack\\78fd31ff2c3e8878eb2cbf15dacc59f3.js", "pre_content": "<span class='line'>1</span>      ... \":typeof e})(e)}function _classCallCheck$1(e,t){if(!(e instanceof ...<br><span class='line'></span>      ", "content": "<span class='line'>1</span>      ypeof e}:function(e){return e&&\"function\"==typeof <br><span class='line'>1</span>      Symbol&&e.constructor===Symbol&&e!==Symbol.prototy<br><span class='line'>1</span>      pe?\"symbol\":typeof e})(e)}function _classCallCheck<br><span class='line'>1</span>      $1(e,t){if(!(e instanceof t))throw new TypeError(\"<br><span class='line'>1</span>      Cannot call a class as a function\")}function _defi", "view": false, "lock": false},{"id": 6, "name": "bd9db8a554b05041b7d569ed65daf47e.js", "path": "F:\\\u5b66\u4e60\u7b14\u8bb0\\\u5fae\u4fe1\u9006\u5411\u5b66\u4e60\\core\\wxapkg.unpack\\bd9db8a554b05041b7d569ed65daf47e.js", "pre_content": "<span class='line'>2</span>      ... ,o=u.get(e),i=n.replace(/\\*\\[(.*?)\\]/g,\"$1\");o.kbDesc=i,o.origin= ...<br><span class='line'></span>      ", "content": "<span class='line'>2</span>      name=function(e){return u.get(e)},exports.setItemO<br><span class='line'>2</span>      fShortcutname=function(e,t){const{kbDesc:n=\"\",orig<br><span class='line'>2</span>      in:r=\"\"}=t,o=u.get(e),i=n.replace(/\\*\\[(.*?)\\]/g,\"<br><span class='line'>2</span>      $1\");o.kbDesc=i,o.origin=r},exports.onDidMenuChang<br><span class='line'>2</span>      e=function(e){return r.on(\"menuChange\",e),{dispose", "view": false, "lock": false})
</script>